########################
### write results db ###
########################
bDir <- "../../data/processed/balderResultsDb"
timestamp <- format(Sys.time(), "%Y%m%d")
# output db for harmonized data
outDbName <- paste0(bDir,"/balder-harmonized-biomarker-data-v",timestamp,".sqlite")
harmonizedDb <- DBI::dbConnect(RSQLite::SQLite(), outDbName)
# output db for compiled raw data
outDbName2 <- paste0(bDir,"/balder-compiled-raw-data-v",timestamp,".sqlite")
#rawDataDb <- DBI::dbConnect(RSQLite::SQLite(), outDbName2)
# Harmonized table
RSQLite::dbWriteTable(harmonizedDb, "MoaCiVICRuleEntries", dbRules)
RSQLite::dbWriteTable(harmonizedDb, "actionableSNVsByGenomicCoordinate", dbGenome)
RSQLite::dbWriteTable(harmonizedDb, "actionableSNVsByAAChange", dbAlteration)
RSQLite::dbWriteTable(harmonizedDb, "MoaCiVICOtherAlterations", dbOtherAlt)
### Disconnect from SQL db
RSQLite::dbDisconnect(harmonizedDb)
#RSQLite::dbDisconnect(rawDataDb)
########
outRFile <- paste0(outDir,"/actionDbCurration-",timestamp,".RData")
save.image(file = outRFile)
outRFile
rm(list=ls())
timestamp()
##------ Mon Mar 11 16:31:55 2024 ------##
paste0(bDir,"/balder-harmonized-biomarker-data-v",timestamp,".sqlite")
### connect to result DB and get variants
bDir <- "../../data/processed/balderResultsDb"
paste0(bDir,"/balder-harmonized-biomarker-data-v",timestamp,".sqlite")
bDir <- "../../data/processed/balderResultsDb"
dbName <- paste0(bDir,"/balder-harmonized-biomarker-data-v20240311.sqlite")
harmonizedDb <- DBI::dbConnect(RSQLite::SQLite(), dbName)
bDir <- "../../data/processed/balderResultsDb"
dbName <- paste0(bDir,"/balder-harmonized-biomarker-data-v20240311.sqlite")
harmonizedDb <- DBI::dbConnect(RSQLite::SQLite(), dbName)
# load clinical annotations
dbRules <- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM MoaCiVICRuleEntries')
poVariants<- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM patientObservedVariantTable')
print(dim(svCompiled))
head(poVariants)
poVariants$Protein_position
table(poVariants$Protein_position)
print(dim(poVariants))
rm(list=ls())
head(dbAlteration)
dbAlterations <- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM actionableSNVsByAAChange')
library(dplyr)
library(tidyr)
library(DBI)
library(RSQLite)
### connect to result DB and get variants
bDir <- "../../data/processed/balderResultsDb"
dbName <- paste0(bDir,"/balder-harmonized-biomarker-data-v20240311.sqlite")
harmonizedDb <- DBI::dbConnect(RSQLite::SQLite(), dbName)
# load clinical annotations
dbRules <- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM MoaCiVICRuleEntries')
dbAlterations <- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM actionableSNVsByAAChange')
#dbGenome <- RSQLite::dbGetQuery(mydb, 'SELECT * FROM actionableSNVsByGenomicCoordinate')
head(dbAlterations)
poVariants<- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM patientObservedVariantTable')
print(dim(poVariants))
sampleInfoCompiled <- RSQLite::dbGetQuery(mydb, 'SELECT * FROM harmonizedSampleInfo')
sampleInfoCompiled <- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM harmonizedSampleInfo')
print(dim(svCompiled))
sampleInfoCompiled <- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM harmonizedSampleInfo')
print(dim(sampleInfoCompiled))
head(poVariants$HGVSp)
tail(poVariants$HGVSp)
tail(poVariants$HGVSc)
tail(poVariants$HGVSp)
tail(poVariants$HGVSp_Short)
head(poVariants$HGVSp_Short)
dd
svCompiled <- poVariants %>%
dplyr::left_join(sampleInfoCompiled[,!colnames(sampleInfoCompiled)=="SourceStudy"],
by=c("sample"="SAMPLE_ID"))
head(sampleInfoCompiled)
colnames(poVariants)
colnames(poVariants$Tumor_Sample_Barcode)
table(poVariants$Tumor_Sample_Barcode %in% sampleInfoCompiled$SAMPLE_ID)
head(svCompiled)
svCompiled <- poVariants %>%
dplyr::left_join(sampleInfoCompiled[,!colnames(sampleInfoCompiled)=="SourceStudy"],
by=c("Tumor_Sample_Barcode"="SAMPLE_ID"))
head(svCompiled)
dbGenome <- RSQLite::dbGetQuery(mydb, 'SELECT * FROM actionableSNVsByGenomicCoordinate')
dbGenome <- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM actionableSNVsByGenomicCoordinate')
head(dbGenome)
head(svCompiled)
genome.matched <- svCompiled %>%
dplyr::left_join(dbGenome,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt"))
table(is.na(genome.matched$source),exclude=NULL)
harmonizedDb <- DBI::dbConnect(RSQLite::SQLite(), dbName)
poVariants<- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM patientObservedVariantTable') %>%
dplyr::mutate(AAChange=stringr::str_replace(HGVSp_short,"p.", ""))
poVariants<- RSQLite::dbGetQuery(harmonizedDb, 'SELECT * FROM patientObservedVariantTable') %>%
dplyr::mutate(AAChange=stringr::str_replace(HGVSp_Short,"p.", ""))
print(dim(poVariants))
head(poVariants)
head(dbAlterations)
aa.matched <- svCompiled %>%
dplyr::left_join(dbAlteration,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange"))
aa.matched <- svCompiled %>%
dplyr::left_join(dbAlterations,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange"))
aa.matched <- svCompiled %>%
dplyr::left_join(dbAlterations,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange"))
colnames(dbAlterations)
svCompiled <- poVariants %>%
dplyr::left_join(sampleInfoCompiled[,!colnames(sampleInfoCompiled)=="SourceStudy"],
by=c("Tumor_Sample_Barcode"="SAMPLE_ID"))
aa.matched <- svCompiled %>%
dplyr::left_join(dbAlterations,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange"))
print(table(aa.matched$source,aa.matched$source,exclude = NULL))
print(table(aa.matched$source,exclude = NULL))
print(table(is.na(aa.matched$source),exclude = NULL))
print(table(aa.matched$feature_type,exclude = NULL))
tail(aa.matched)
genome.matched.unrestricted <- svCompiled %>%
dplyr::left_join(genome.matched.unrestricted,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
genome.matched.unrestricted <- svCompiled %>%
dplyr::left_join(genome.matched.unrestricted,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
genome.matched.unrestricted <- svCompiled %>%
dplyr::left_join(genome.matched.unrestricted,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
genome.matched.unrestricted <- svCompiled %>%
dplyr::left_join(genome.matched.unrestricted,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";"))
genome.matched.unrestricted <- svCompiled %>%
dplyr::left_join(genome.matched.unrestricted,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt"))
genome.matched.unrestricted <- svCompiled %>%
dplyr::left_join(dbGenome,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
print(dim(genome.matched.unrestricted))
print(table(genome.matched.unrestricted$source,exclude = NULL))
head(genome.matched.unrestricted)
table(is.na(genome.matched.unrestricted$source),exclude=NULL)
table(genome.matched.unrestricted$source)
print(table(genome.matched.unrestricted$source,exclude = NULL))
genome.matched.unrestricted <- svCompiled %>%
dplyr::inner_join(dbGenome,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
print(dim(genome.matched.unrestricted))
print(table(genome.matched.unrestricted$source,exclude = NULL))
genome.matched.unrestricted
tail(genome.matched.unrestricted)
head(genome.matched.unrestricted)
table(genome.matched.unrestricted$source)
aa.matched.unrestricted <- svCompiled %>%
dplyr::inner_join(dbAlterations,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange")) %>%
dplyr::group_by(Hugo_Symbol,AAChange) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
print(dim(aa.matched.unrestricted))
print(table(aa.matched.unrestricted$source,exclude = NULL))
print(dim(aa.matched.unrestricted))
print(table(aa.matched.unrestricted$source,exclude = NULL))
print(table(is.na(aa.matched.unrestricted$source),exclude = NULL))
print(table(aa.matched.unrestricted$feature_type,exclude = NULL))
print(table(aa.matched.unrestricted$source,exclude = NULL))
aa.matched.unrestricted
aa.matched.unrestricted <- svCompiled %>%
dplyr::inner_join(dbAlterations,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange")) %>%
dplyr::group_by(Hugo_Symbol,AAChange) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
aa.matched.unrestricted <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange")) %>%
dplyr::group_by(Hugo_Symbol,AAChange) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
print(dim(aa.matched.unrestricted))
print(table(aa.matched.unrestricted$source,exclude = NULL))
head(aa.matched.unrestricted)
genome.matched.unrestricted <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
print(dim(genome.matched.unrestricted))
print(table(genome.matched.unrestricted$source,exclude = NULL))
genome.matched.unrestricted
head(dbRules)
head(svCompiled$ONCOTREE_CODE)
genome.matched.ot.restricted <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt",
"ONCOTREE_CODE"="oncotree_code")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
genome.matched.ot.restricted <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt",
"ONCOTREE_CODE"="oncotree_code"))
table(svCompiled$ONCOTREE_CODE %in% dbRules$oncotree_code)
head(svCompiled$ONCOTREE_CODE)
head(dbRules$oncotree_code)
genome.matched.ot.restricted <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt",
"ONCOTREE_CODE"="oncotree_code"))
head(genome.matched.ot.restricted)
genome.matched.ot.restricted <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt",
"ONCOTREE_CODE"="oncotree_code")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
genome.matched.ot.restricted
dbRules$Disease
genome.matched.ot.restricted <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Chromosome"="chromosome",
"Start_Position"="pos",
"Reference_Allele"="ref",
"Tumor_Seq_Allele2"="alt",
"ONCOTREE_CODE"="oncotree_code")) %>%
dplyr::group_by(Chromosome,Start_Position,Tumor_Seq_Allele2,ONCOTREE_CODE) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
genome.matched.ot.restricted
aa.matched.ot.restricted <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code")) %>%
dplyr::group_by(Hugo_Symbol,AAChange,ONCOTREE_CODE) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
aa.matched.ot.restricted
n.patients <- length(unique(svCompiled$Tumor_Sample_Barcode))
n.patients <- length(unique(svCompiled$Tumor_Sample_Barcode))
n.variants <- length(unique(dbAlteration$AAChange))
n.patients <- length(unique(svCompiled$Tumor_Sample_Barcode))
n.variants <- length(unique(dbAlterations$AAChange))
c1 <- c("Restricted","Restricted","Unestricted","Unestricted")
c2 <- c("genome","AA change", "genome", "AA change")
c3 <- c(dim(genome.matched.ot.restricted)[[1]],
dim(aa.matched.ot.restricted)[[1]],
dim(genome.matched.unrestricted)[[1]],
dim(aa.matched.unrestricted)[[1]])
#c4 <- paste0(round(100*(c3/n.variants),1),"%")
c5 <- c(sum(genome.matched.ot.restricted$n.patients.mutated),
sum(aa.matched.ot.restricted$n.patients.mutated),
sum(genome.matched.unrestricted$n.patients.mutated),
sum(aa.matched.unrestricted$n.patients.mutated))
c6 <- paste0(round(100*(c5/n.patients),1),"%")
# Create a data frame
df <- data.frame(c1=c1, c2=c2, c3=c3, c4=c4, c5=c5, c6=c6)
n.variants
# Create a data frame
df <- data.frame(c1=c1, c2=c2, c3=c3, c5=c5, c6=c6)
colnames(df) <- c("Cancer type match restriction", "Cancer type matching approach", "number of variants","number of patients","percent of patients")
# Print the data frame
#print(df)
knitr::kable(df, )
df
head(aa.matched.ot.restricted)
cType.sample.counts <- svCompiled %>%
dplyr::group_by(ONCOTREE_CODE) %>%
dplyr::summarise(n.patients=dplyr::n_distinct(Tumor_Sample_Barcode))
head(cType.sample.counts)
cType.sample.counts <- svCompiled %>%
dplyr::group_by(ONCOTREE_CODE) %>%
dplyr::summarise(n.patients=dplyr::n_distinct(Tumor_Sample_Barcode)) %>%
dplyr::arrange(desc(cType.sample.counts))
head(cType.sample.counts)
cType.sample.counts <- svCompiled %>%
dplyr::group_by(ONCOTREE_CODE) %>%
dplyr::summarise(n.patients=dplyr::n_distinct(Tumor_Sample_Barcode)) %>%
dplyr::arrange(desc(cType.sample.counts))
head(cType.sample.counts)
cType.sample.counts <- svCompiled %>%
dplyr::group_by(ONCOTREE_CODE) %>%
dplyr::summarise(n.patients=dplyr::n_distinct(Tumor_Sample_Barcode)) %>%
dplyr::arrange(desc(n.patients))
head(cType.sample.counts)
dim(cType.sample.counts)
aa.matched.by.cType <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code")) %>%
dplyr::group_by(ONCOTREE_CODE)
aa.matched.by.cType <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code")) %>%
dplyr::group_by(ONCOTREE_CODE) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
head(aa.matched.by.cType)
aa.matched.by.cType <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code"))
head(aa.matched.by.cType)
table(aa.matched.by.cType$clinical.evidence.summary)
aa.matched.one.to.many <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code"))
aa.matched.one.to.many <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange")
)
?dplyr::inner_join
aa.matched.patient.summary <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code"),
relationship = "many-to-many") %>%
dplyr::group_by(Tumor_Sample_Barcode) %>%
dplyr::summarize(n.patients.mutated=dplyr::n_distinct(Tumor_Sample_Barcode),
actionSummary=paste0(unique(actionability.summary),collapse=";"),
clinEvidienceSummary=paste0(unique(clinical.evidence.summary),collapse=";"),
otCode=paste0(unique(ONCOTREE_CODE),collapse=";"),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";"),
) %>%
dplyr::arrange(desc(n.patients.mutated))
head(aa.matched.patient.summary)
aa.matched.patient.summary <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code"),
relationship = "many-to-many") %>%
dplyr::group_by(Tumor_Sample_Barcode) %>%
dplyr::summarize(n.variants.matched=dplyr::n_distinct(AAChange),
actionSummary=paste0(unique(actionability.summary),collapse=";"),
clinEvidienceSummary=paste0(unique(clinical.evidence.summary),collapse=";"),
otCode=paste0(unique(ONCOTREE_CODE),collapse=";"),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";"),
) %>%
dplyr::arrange(desc(n.patients.mutated))
aa.matched.patient.summary <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code"),
relationship = "many-to-many") %>%
dplyr::group_by(Tumor_Sample_Barcode) %>%
dplyr::summarize(n.variants.matched=dplyr::n_distinct(AAChange),
actionSummary=paste0(unique(actionability.summary),collapse=";"),
clinEvidienceSummary=paste0(unique(clinical.evidence.summary),collapse=";"),
otCode=paste0(unique(ONCOTREE_CODE),collapse=";"),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.patients.mutated))
aa.matched.patient.summary <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code"),
relationship = "many-to-many") %>%
dplyr::group_by(Tumor_Sample_Barcode) %>%
dplyr::summarize(n.variants.matched=dplyr::n_distinct(AAChange),
actionSummary=paste0(unique(actionability.summary),collapse=";"),
clinEvidienceSummary=paste0(unique(clinical.evidence.summary),collapse=";"),
otCode=paste0(unique(ONCOTREE_CODE),collapse=";"),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.variants.matched))
head(aa.matched.patient.summary)
table(aa.matched.patient.summary)
table(aa.matched.patient.summary$actionSummary)
aa.matched.patient.summary <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code"),
relationship = "many-to-many") %>%
dplyr::group_by(Tumor_Sample_Barcode) %>%
dplyr::summarize(n.variants.matched=dplyr::n_distinct(AAChange),
actionSummary=paste0(unique(actionability.summary),collapse=";"),
clinEvidienceSummary=paste0(unique(clinical.evidence.summary),collapse=";"),
PredTherapy="Predictive therapy actionability" %in% clinical.evidence.summary,
otCode=paste0(unique(ONCOTREE_CODE),collapse=";"),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.variants.matched))
table(aa.matched.patient.summary$actionSummary)
table(aa.matched.patient.summary$PredTherapy)
table(aa.matched.patient.summary$PredTherapy,exclude=NULL)
table(dbRules$clinical.evidence.summary)
table(dbRules$actionability.summary)
aa.matched.patient.summary <- svCompiled %>%
dplyr::inner_join(dbRules,by=c("Hugo_Symbol"="gene",
"AAChange"="AAChange",
"ONCOTREE_CODE"="oncotree_code"),
relationship = "many-to-many") %>%
dplyr::group_by(Tumor_Sample_Barcode) %>%
dplyr::summarize(n.variants.matched=dplyr::n_distinct(AAChange),
actionSummary=paste0(unique(actionability.summary),collapse=";"),
predTherapyAction="Predictive therapy actionability" %in% actionability.summary,
prognosticAction="Prognostic" %in% actionability.summary,
resistanceAction="Therapy resistance" %in% actionability.summary,
otherAction="Other" %in% actionability.summary,
clinEvidienceSummary=paste0(unique(clinical.evidence.summary),collapse=";"),
otCode=paste0(unique(ONCOTREE_CODE),collapse=";"),
disease=paste0(unique(Disease),collapse=";"),
source=paste0(unique(source),collapse=";"),
Drugs=paste0(unique(Drugs),collapse=";"),
ReferenceOrTrialID=paste0(unique(ReferenceOrTrialID),collapse=";")) %>%
dplyr::arrange(desc(n.variants.matched))
head(aa.matched.patient.summary)
head(dbRules)
table(dbRules$FDAApproved)
head(dbRules)
seq(1,10)
dim(dbRules)
dbRules$balderRuleID <- seq(1,dim(dbRules)[[1]])
dim(dbRules)
tail(dbRules)
dim(dbRules)
quit()
